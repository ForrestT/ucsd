<!DOCTYPE html>
<html>
<body>

<h1>Bluecat SOAP API script testing</h1>
<p>Tests extracting the Cookie out of a reponse header array, see console log</p>

<button onclick="soaptime()">Run SOAP</button>
<br/>

CIDR: <input type="text" id="cidr_text">
<button onclick="cidr_parser(document.getElementById('cidr_text').value)">Get Network and Netmask</button>

<div id="cidr_output"></div>

<script>
  function soaptime() {
    console.log("starting...");
    var headers = ["Set-Cookie: JSESSIONID=902BC30E5323F62A65D165D067EE8B11; Path=/Services",
                  "Content-Type: text/xml;charset=UTF-8",
                  "Transfer-Encoding: chunked",
                  "Date: Fri, 13 Mar 2015 17:02:54 GMT",
                  "Server: BAM"];
    for (var i = 0; i < headers.length; i++) {
      console.log(headers[i]);
      if (headers[i].search("Set-Cookie") > -1) {
        start_index = headers[i].search("JSESSIONID"); //12
        console.log(start_index);
        end_index = headers[i].search(";"); //55
        console.log(end_index);
        cookie_length = end_index - start_index //43
        console.log(cookie_length)
        cookie = headers[i].substr(start_index, cookie_length);
        console.log(cookie);
        break;
      }
    }
    console.log("Done");
  }

  function ipv4_to_int(ip) {
    var o = ip.split(".");
    var num = (parseInt(o[0]) << 24) | (parseInt(o[1]) << 16) | (parseInt(o[2]) << 8) | parseInt(o[3]);
    return num;
  }

  function int_to_ipv4(num) {
    var o1 = num >>> 24;
    var o2 = (num << 8) >>> 24;
    var o3 = (num << 16) >>> 24;
    var o4 = (num << 24) >>> 24;
    var ipv4 = o1.toString() +'.'+ o2.toString() +'.'+ o3.toString() +'.'+ o4.toString();
    return ipv4;
  }

  function cidr_parser(cidr='10.168.50.12/23') {
    console.log("CIDR = " + cidr);
    var temp = cidr.split("/");
    var addr = ipv4_to_int(temp[0]);
    ipv4_addr = int_to_ipv4(addr);
    console.log(ipv4_addr);
    console.log(temp[1]);
    var mask = -1 << (32 - parseInt(temp[1]));
    ipv4_mask = int_to_ipv4(mask);
    console.log(ipv4_mask);
    var net = addr & mask;
    ipv4_net = int_to_ipv4(net);
    ipv4_gw = int_to_ipv4(net + 1);
    console.log(ipv4_net);
    var output = "<h2>CIDR: " + cidr 
    		+ "<br/>NET:  " + ipv4_net 
    		+ "<br/>MASK: " + ipv4_mask 
    		+ "<br/>GW:   " + ipv4_gw + "<h2/>";
    document.getElementById("cidr_output").innerHTML = output;
  }
</script>

</body>
</html>
